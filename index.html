<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <title>EggScream ‚Äî The Screaming Chicken Beat</title>
  <meta name="viewport" content="width=device-width, initial-scale=1" />

  <!-- canonical + assets rinominati per bustare la cache -->
  <link rel="canonical" href="https://www.eggscream.com/">
  <link rel="icon" href="/favicon.v2.ico">
  <meta property="og:title" content="EggScream ‚Äî $1 Make It Scream">
  <meta property="og:description" content="Pay $1. Make the chicken scream. No refunds. Only scream.">
  <meta property="og:image" content="/og-v2.png">

  <style>
    :root { --bg:#fff; --ink:#111; --muted:#666; }
    html,body{margin:0;background:var(--bg);color:var(--ink);font:16px/1.4 system-ui,-apple-system,Segoe UI,Roboto,Arial,sans-serif}
    .wrap{min-height:100dvh;display:flex;align-items:center;justify-content:center}
    .inner{width:min(680px,92vw);text-align:center}
    h1{margin:0 0 .4rem;font-size:clamp(28px,6vw,54px);font-weight:900;letter-spacing:-.02em}
    p{margin:.25rem 0 0}
    .muted{color:var(--muted);font-size:12px;margin-top:.6rem}
    .btn{
      display:inline-block;margin-top:1rem;padding:.9rem 1.2rem;border:1.5px solid #111;
      color:#111;background:transparent;font-weight:900;letter-spacing:.02em;text-decoration:none;
      cursor:pointer;user-select:none;transition:transform .06s ease, background .12s ease;
    }
    .btn:hover{background:#f2f2f2}
    .btn:active{transform:translateY(1px)}
    .flash{animation:flash .28s ease-in-out 1}
    @keyframes flash{0%{background:#fff}50%{background:#fff6f6}100%{background:#fff}}
    @media (prefers-reduced-motion:reduce){ .flash{animation:none} .btn{transition:none} }

    /* --- Modale pagamento --- */
    .payModal{display:none;position:fixed;inset:0;background:rgba(0,0,0,.55);
      backdrop-filter:blur(3px);z-index:100;align-items:center;justify-content:center}
    .payModal:target{display:flex}
    .payContent{
      background:#fff;border:2px solid #eee;border-radius:12px;
      padding:22px;max-width:420px;width:92%;text-align:center;
      box-shadow:0 10px 30px rgba(0,0,0,.35)
    }
    .payBtns{display:flex;flex-direction:column;gap:10px;margin:18px 0}
    .payBtn{display:block;padding:12px 14px;border-radius:10px;font-weight:700;text-decoration:none;color:#fff;cursor:pointer}
    .payBtn.stripe{background:#635bff}
    .payNote{font-size:12px;color:#666;margin-top:6px}
    .miniBtn{border:0;background:#eee;color:#111;padding:8px 10px;border-radius:10px;cursor:pointer}

    /* CTA post-pagamento (fallback autoplay) */
    #celebrateCta{display:none;margin-top:12px;border:0;border-radius:10px;padding:10px 12px;cursor:pointer;
      background:#ffe08a;color:#3a2500;font-weight:800}
  </style>
</head>
<body>
  <div class="wrap" id="stage">
    <div class="inner">
      <h1>chicken or egg?</h1>
      <p><strong>neither. the scream came first.</strong></p>

      <!-- Il bottone apre la MODALE di pagamento -->
      <a id="btn" class="btn" href="#payModal">üí•üêîü•ö 1$ MAKE IT SCREAM ‚Äî PLAY THE BEAT üí•üêîü•ö</a>

      <p class="muted">Volume high. No refunds. Only scream.</p>

      <!-- CTA che appare solo se l‚Äôautoplay viene bloccato DOPO pagamento -->
      <button id="celebrateCta">Tap to celebrate üéâüêî</button>
    </div>
  </div>

  <!-- =================== MODALE PAGAMENTO =================== -->
  <div id="payModal" class="payModal" aria-hidden="true" onclick="location.hash='';">
    <div class="payContent" role="dialog" aria-modal="true" aria-label="Payment options" onclick="event.stopPropagation()">
      <h3>Choose your payment</h3>
      <p>üí• This $1 will trigger the screaming beat.</p>
      <div class="payBtns">
        <!-- Stripe Payment Link: SOSTITUISCI con il tuo link -->
        <a
          id="stripeLink"
          href="https://buy.stripe.com/test_dRm8wI5wBf9l21W20P9oc01?success=1"
          class="payBtn stripe"
          target="_blank" rel="noopener"
          >üí≥ Pay with Stripe</a>

        <!-- PayPal (opzionale) -->
        <div id="paypalButtons"></div>
        <div class="payNote">PayPal stays on-screen and returns automatically.</div>
      </div>
      <button class="miniBtn" onclick="location.hash=''">Cancel</button>
    </div>
  </div>
  <!-- ======================================================== -->

  <script>
  // ---------- Audio setup ----------
  let ctx;
  function ac(){ if(!ctx) ctx = new (window.AudioContext||window.webkitAudioContext)(); return ctx; }
  async function ensureRunning(){
    const c = ac();
    if (c.state === 'suspended') { try { await c.resume(); } catch(e){} }
    if (c.state !== 'running') {
      await new Promise(res=>{
        const onChange=()=>{ if(c.state==='running'){ c.removeEventListener('statechange',onChange); res(); } };
        c.addEventListener('statechange', onChange);
      });
    }
    return c;
  }
  function mkDist(c, amt=24){
    const ws = c.createWaveShaper(), n=512, curve=new Float32Array(n);
    for(let i=0;i<n;i++){ const x=i/n*2-1; curve[i]=Math.tanh(amt*x); }
    ws.curve=curve; ws.oversample='4x'; return ws;
  }
  function flash(){
    const stg = document.getElementById('stage');
    stg.classList.remove('flash'); void stg.offsetWidth; stg.classList.add('flash');
  }

  // ---------- Drum blocks ----------
  function kickPlop(c, t, out){
    const o = c.createOscillator(); o.type='sine';
    const g = c.createGain();
    o.frequency.setValueAtTime(140, t);
    o.frequency.exponentialRampToValueAtTime(55, t+0.16);
    g.gain.setValueAtTime(0.9, t);
    g.gain.exponentialRampToValueAtTime(0.0001, t+0.18);
    o.connect(g).connect(out); o.start(t); o.stop(t+0.19);
  }
  function snareCluck(c, t, out){
    const o = c.createOscillator(); o.type='square';
    const g = c.createGain();
    o.frequency.setValueAtTime(750, t);
    o.frequency.exponentialRampToValueAtTime(300, t+0.07);
    g.gain.setValueAtTime(0.85, t);
    g.gain.exponentialRampToValueAtTime(0.0001, t+0.1);
    o.connect(g).connect(out); o.start(t); o.stop(t+0.11);
  }
  function hatClick(c, t, out){
    const buf = c.createBuffer(1, Math.floor(c.sampleRate*0.05), c.sampleRate);
    const d = buf.getChannelData(0); for(let i=0;i<d.length;i++) d[i]=(Math.random()*2-1)*0.9;
    const n = c.createBufferSource(); n.buffer = buf;
    const hp = c.createBiquadFilter(); hp.type='highpass'; hp.frequency.value=5000;
    const g = c.createGain(); g.gain.setValueAtTime(0.35, t);
    g.gain.exponentialRampToValueAtTime(0.0001, t+0.05);
    n.connect(hp).connect(g).connect(out); n.start(t); n.stop(t+0.06);
  }

  // ---------- Scream (3s) ----------
  function chickenScream3s(c, t, out){
    flash();
    const len = 3.0;
    const bus = c.createGain(); bus.gain.value = 0.85;
    const dist = mkDist(c, 20);
    const bp = c.createBiquadFilter(); bp.type='bandpass'; bp.frequency.value=1800; bp.Q.value=4.5;
    const lp = c.createBiquadFilter(); lp.type='lowpass'; lp.frequency.value=2800;
    bus.connect(dist).connect(bp).connect(lp).connect(out);

    [-10,+10].forEach(det => {
      const o = c.createOscillator(); o.type='sawtooth';
      const g = c.createGain();
      o.frequency.setValueAtTime(620, t);
      o.detune.setValueAtTime(det, t);
      o.frequency.linearRampToValueAtTime(720, t+0.12);
      o.frequency.exponentialRampToValueAtTime(150, t+len*0.92);

      g.gain.setValueAtTime(0.0001, t);
      g.gain.exponentialRampToValueAtTime(0.95, t+0.06);
      g.gain.exponentialRampToValueAtTime(0.0001, t+len);

      const trem = c.createOscillator(); trem.frequency.value = 13;
      const tremAmt = c.createGain(); tremAmt.gain.value = 0.7;
      trem.connect(tremAmt.gain); g.connect(tremAmt);

      o.connect(g).connect(bus);
      trem.start(t); trem.stop(t+len);
      o.start(t); o.stop(t+len);
    });

    const nbuf = c.createBuffer(1, Math.floor(c.sampleRate*len), c.sampleRate);
    const d = nbuf.getChannelData(0); for(let i=0;i<d.length;i++) d[i]=Math.random()*2-1;
    const n = c.createBufferSource(); n.buffer = nbuf;
    const nBP = c.createBiquadFilter(); nBP.type='bandpass'; nBP.frequency.value=2600; nBP.Q.value=6;
    const ng = c.createGain();
    ng.gain.setValueAtTime(0.001, t+0.08);
    ng.gain.exponentialRampToValueAtTime(0.5, t+0.22);
    ng.gain.exponentialRampToValueAtTime(0.0001, t+len);
    n.connect(nBP).connect(ng).connect(bus);
    n.start(t); n.stop(t+len);

    return t + len;
  }

  // ---------- Beat (2s) ----------
  function scheduleBeat2s(c, start, out){
    const dur = 2.0, beat = 0.5; // 120 BPM
    for(let i=0;i<4;i++){
      const t = start + i*beat;
      if(i===0 || i===2) kickPlop(c, t, out); else snareCluck(c, t, out);
      hatClick(c, t, out); hatClick(c, t + beat/2, out);
    }
    return start + dur;
  }

  // ---------- Alternanza: 3s scream -> 2s beat -> loop ----------
  let loopTimer = null, cleanup = null, isPlaying = false;

  async function playAlternating(){
    const c = await ensureRunning();
    if (cleanup) { try{ cleanup(); }catch(e){} cleanup = null; }

    const master = c.createGain(); master.gain.value = 0.95;
    const softLim = mkDist(c, 12);
    const comp = c.createDynamicsCompressor();
    comp.threshold.value = -10; comp.knee.value = 8; comp.ratio.value = 6; comp.attack.value = 0.002; comp.release.value = 0.06;
    master.connect(softLim).connect(comp).connect(c.destination);

    const PERIOD = 5.0;
    let base = c.currentTime + 0.08;

    const afterScream = chickenScream3s(c, base, master);
    scheduleBeat2s(c, afterScream + 0.06, master);

    loopTimer = setInterval(()=>{
      base += PERIOD;
      const endS = chickenScream3s(c, base, master);
      scheduleBeat2s(c, endS + 0.06, master);
    }, PERIOD * 1000);

    cleanup = () => { try{ clearInterval(loopTimer); }catch(e){} loopTimer = null;
      try{ master.disconnect(); softLim.disconnect(); comp.disconnect(); }catch(e){}
      try{ c.suspend(); }catch(e){} };
    isPlaying = true;
    document.getElementById('btn').textContent = "üõë STOP THE SCREAM";
    document.getElementById('celebrateCta').style.display = 'none';
  }
  function stopAlternating(){
    if (cleanup) { try{ cleanup(); }catch(e){} } cleanup = null;
    isPlaying = false;
    document.getElementById('btn').textContent = "üí•üêîü•ö 1$ MAKE IT SCREAM ‚Äî PLAY THE BEAT üí•üêîü•ö";
  }

  // --------- Post-pagamento & UI ---------
  const btn = document.getElementById('btn');
  const celebrateCta = document.getElementById('celebrateCta');
  const stripeLink = document.getElementById('stripeLink');

  // salva flag prima di uscire verso Stripe
  if (stripeLink) {
    stripeLink.addEventListener('click', () => {
      try { localStorage.setItem('eggscreamPending','1'); } catch(e){}
    });
  }

  // al ritorno: query, referrer, o flag ‚Üí autoplay o TAP
(async function maybeAutoStart(){
  const p = new URLSearchParams(location.search);

  // 1) pagato via query (pi√π permissivo: basta success=1)
  const queryPaid = (p.get('success') === '1');

  // 2) potremmo essere passati da eggscream.com ‚Üí www.eggscream.com:
  //    in quel caso il referrer √® eggscream.com (non stripe),
  //    ma *contiene ancora la query ?success=1*. Verifichiamolo.
  const ref = document.referrer || "";
  const refHasSuccess = /[?&]success=1\b/i.test(ref);

  // 3) oppure veniamo direttamente da stripe.com (senza redirect)
  const cameFromStripe = /stripe\.com/i.test(ref);

  // 4) flag locale messo quando si clicca "Pay with Stripe"
  let hadPending = false;
  try { hadPending = localStorage.getItem('eggscreamPending') === '1'; } catch(e){}

  // se non abbiamo alcun segnale di ritorno da pagamento, non fare nulla (niente TAP al primo load)
  if (!(queryPaid || refHasSuccess || cameFromStripe || hadPending)) return;

  // pulisci URL (toglie ?success=1 se presente)
  try { history.replaceState({}, document.title, location.pathname); } catch(e){}

  // prova ad avviare subito; se l'autoplay √® bloccato, mostra TAP
  try { await playAlternating(); } catch(e){}
  if (!isPlaying || (ctx && ctx.state !== 'running')) showTapToPlay();

  // pulizia flag
  try { localStorage.removeItem('eggscreamPending'); } catch(e){}
})();


  function showTapToPlay(){
    if (celebrateCta.style.display !== 'inline-block') {
      celebrateCta.style.display = 'inline-block';
      celebrateCta.onclick = () => { playAlternating(); celebrateCta.style.display='none'; };
    }
  }

  // mentre suona, il bottone principale diventa STOP (non riapre la modale)
  btn.addEventListener('click', (e) => {
    if (isPlaying) { e.preventDefault(); stopAlternating(); }
  });

  // --------- PayPal lazy (facoltativo) ----------
  // (lasciato com'era; ricorda di impostare il tuo client-id)
  </script>
</body>
</html>






